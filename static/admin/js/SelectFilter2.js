!function(e){"use strict";window.SelectFilter={init:function(t,l,i){if(!t.match(/__prefix__/)){var o=document.getElementById(t);o.id+="_from",o.className="filtered";for(var n=o.parentNode.getElementsByTagName("p"),c=0;c<n.length;c++)-1!==n[c].className.indexOf("info")?o.parentNode.removeChild(n[c]):-1!==n[c].className.indexOf("help")&&o.parentNode.insertBefore(n[c],o.parentNode.firstChild);var r=quickElement("div",o.parentNode);r.className=i?"selector stacked":"selector";var a=quickElement("div",r);a.className="selector-available";var s=quickElement("h2",a,interpolate(gettext("Available %s")+" ",[l]));quickElement("span",s,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of available %s. You may choose some by selecting them in the box below and then clicking the "Choose" arrow between the two boxes.'),[l]));var d=quickElement("p",a,"","id",t+"_filter");d.className="selector-filter";var m=quickElement("label",d,"","for",t+"_input");quickElement("span",m,"","class","help-tooltip search-label-icon","title",interpolate(gettext("Type into this box to filter down the list of available %s."),[l])),d.appendChild(document.createTextNode(" "));var h=quickElement("input",d,"","type","text","placeholder",gettext("Filter"));h.id=t+"_input",a.appendChild(o);var f=quickElement("a",a,gettext("Choose all"),"title",interpolate(gettext("Click to choose all %s at once."),[l]),"href","#","id",t+"_add_all_link");f.className="selector-chooseall";var _=quickElement("ul",r);_.className="selector-chooser";var u=quickElement("a",quickElement("li",_),gettext("Choose"),"title",gettext("Choose"),"href","#","id",t+"_add_link");u.className="selector-add";var v=quickElement("a",quickElement("li",_),gettext("Remove"),"title",gettext("Remove"),"href","#","id",t+"_remove_link");v.className="selector-remove";var k=quickElement("div",r);k.className="selector-chosen";var g=quickElement("h2",k,interpolate(gettext("Chosen %s")+" ",[l]));quickElement("span",g,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of chosen %s. You may remove some by selecting them in the box below and then clicking the "Remove" arrow between the two boxes.'),[l])),quickElement("select",k,"","id",t+"_to","multiple","multiple","size",o.size,"name",o.getAttribute("name")).className="filtered";var p=quickElement("a",k,gettext("Remove all"),"title",interpolate(gettext("Click to remove all chosen %s at once."),[l]),"href","#","id",t+"_remove_all_link");p.className="selector-clearall",o.setAttribute("name",o.getAttribute("name")+"_old");var x=function(e,l,i,o,n){-1!==l.className.indexOf("active")&&(i(o,n),SelectFilter.refresh_icons(t)),e.preventDefault()};if(f.addEventListener("click",function(e){x(e,this,SelectBox.move_all,t+"_from",t+"_to")}),u.addEventListener("click",function(e){x(e,this,SelectBox.move,t+"_from",t+"_to")}),v.addEventListener("click",function(e){x(e,this,SelectBox.move,t+"_to",t+"_from")}),p.addEventListener("click",function(e){x(e,this,SelectBox.move_all,t+"_to",t+"_from")}),h.addEventListener("keypress",function(e){SelectFilter.filter_key_press(e,t)}),h.addEventListener("keyup",function(e){SelectFilter.filter_key_up(e,t)}),h.addEventListener("keydown",function(e){SelectFilter.filter_key_down(e,t)}),r.addEventListener("change",function(e){"SELECT"===e.target.tagName&&SelectFilter.refresh_icons(t)}),r.addEventListener("dblclick",function(e){"OPTION"===e.target.tagName&&(e.target.closest("select").id===t+"_to"?SelectBox.move(t+"_to",t+"_from"):SelectBox.move(t+"_from",t+"_to"),SelectFilter.refresh_icons(t))}),function e(t){return"form"!==t.tagName.toLowerCase()?e(t.parentNode):t}(o).addEventListener("submit",function(){SelectBox.select_all(t+"_to")}),SelectBox.init(t+"_from"),SelectBox.init(t+"_to"),SelectBox.move(t+"_from",t+"_to"),!i){var E=e("#"+t+"_from"),y=e("#"+t+"_to"),N=function(){y.height(e(d).outerHeight()+E.outerHeight())};E.outerHeight()>0?N():y.closest("fieldset").one("show.fieldset",N)}SelectFilter.refresh_icons(t)}},any_selected:function(e){var t=!1;try{e.attr("required","required"),t=e.is(":valid"),e.removeAttr("required")}catch(l){t=e.find("option:selected").length>0}return t},refresh_icons:function(t){var l=e("#"+t+"_from"),i=e("#"+t+"_to");e("#"+t+"_add_link").toggleClass("active",SelectFilter.any_selected(l)),e("#"+t+"_remove_link").toggleClass("active",SelectFilter.any_selected(i)),e("#"+t+"_add_all_link").toggleClass("active",l.find("option").length>0),e("#"+t+"_remove_all_link").toggleClass("active",i.find("option").length>0)},filter_key_press:function(e,t){var l=document.getElementById(t+"_from");if(e.which&&13===e.which||e.keyCode&&13===e.keyCode)return l.selectedIndex=0,SelectBox.move(t+"_from",t+"_to"),l.selectedIndex=0,e.preventDefault(),!1},filter_key_up:function(e,t){var l=document.getElementById(t+"_from"),i=l.selectedIndex;return SelectBox.filter(t+"_from",document.getElementById(t+"_input").value),l.selectedIndex=i,!0},filter_key_down:function(e,t){var l=document.getElementById(t+"_from");if(e.which&&39===e.which||e.keyCode&&39===e.keyCode){var i=l.selectedIndex;return SelectBox.move(t+"_from",t+"_to"),l.selectedIndex=i===l.length?l.length-1:i,!1}return(e.which&&40===e.which||e.keyCode&&40===e.keyCode)&&(l.selectedIndex=l.length===l.selectedIndex+1?0:l.selectedIndex+1),(e.which&&38===e.which||e.keyCode&&38===e.keyCode)&&(l.selectedIndex=0===l.selectedIndex?l.length-1:l.selectedIndex-1),!0}},window.addEventListener("load",function(t){e("select.selectfilter, select.selectfilterstacked").each(function(){var t=e(this),l=t.data();SelectFilter.init(t.attr("id"),l.fieldName,parseInt(l.isStacked,10))})})}(django.jQuery);